<UserControl x:Class="Echo.Views.ChatViewRegion.RecentChatListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:Echo.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:local="clr-namespace:Echo.Views.ChatViewRegion"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             d:DesignHeight="450"
             d:DesignWidth="250"
             mc:Ignorable="d">
    <UserControl.Resources>
        <converters:IntGreaterThanZeroToVisibilityConverter x:Key="IntGreaterThanZeroToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <ListView ItemsSource="{Binding Chats}"
                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                  SelectedItem="{Binding SelectedChat, Mode=TwoWay}">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding OpenChatCommand}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListView}}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>

                        <Border Width="40"
                                Height="40"
                                BorderBrush="White"
                                BorderThickness="0.6"
                                CornerRadius="25">
                            <Border.Background>
                                <ImageBrush ImageSource="{Binding Avatar}" />
                            </Border.Background>
                        </Border>
                        <Border Width="10"
                                Height="10"
                                Margin="5"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Background="LightGreen"
                                CornerRadius="15" />

                        <StackPanel Grid.Column="1">
                            <TextBlock Margin="10,0"
                                       Text="{Binding SendName}"
                                       TextTrimming="CharacterEllipsis" />
                            <TextBlock Margin="10,0"
                                       FontSize="11"
                                       Opacity="0.6"
                                       Text="{Binding RecentMsg}"
                                       TextTrimming="CharacterEllipsis" />
                        </StackPanel>

                        <Border Grid.Column="2"
                                Width="20"
                                Height="20"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Background="MediumVioletRed"
                                CornerRadius="20"
                                Visibility="{Binding UnreadMsgCount, Converter={StaticResource IntGreaterThanZeroToVisibilityConverter}}">
                            <TextBlock HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Foreground="{StaticResource MaterialDesignShadowBrush}"
                                       Text="{Binding UnreadMsgCount}" />
                        </Border>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</UserControl>
